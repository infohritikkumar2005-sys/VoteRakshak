<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Election Results - Vote Rakshak</title>
<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
.results-container{
 display:flex;flex-wrap:wrap;
 justify-content:center;gap:20px;margin-top:20px;
}

/* Chart Cards */
.chart-card{
 background:white;padding:20px;border-radius:10px;
 box-shadow:0 0 10px rgba(0,0,0,.1);
 width:420px;max-width:90%;
}
.chart-title{text-align:center;font-weight:bold;margin-bottom:8px;font-size:18px;color:#0a3475}

/* Winner Banner */
#winnerBox{
 text-align:center;background:#e8f7ff;
 padding:12px;border-radius:8px;
 font-size:22px;font-weight:bold;
 margin:20px auto;color:#0057b3;width:70%;
 box-shadow:0 0 10px rgba(0,0,0,.08);
}

/* Candidate Vote Table (Updated for Full Width) */
.candidateBox{
 max-width:900px;          /* Wider than before */
 width:90%;                /* Fits under both charts */
 margin:30px auto;
 background:white;
 padding:22px 28px;
 border-radius:10px;
 box-shadow:0 0 15px rgba(0,0,0,.08);
}


.candidateRow{
 display:flex;justify-content:space-between;
 align-items:center;padding:10px 5px;
 border-bottom:1px solid #eee;font-size:17px;
}
.candidateRow:last-child{border-bottom:none;}

.candidateRow b{
 color:#05306d;text-transform:capitalize;
}

.voteBadge{
 background:#0057b3;color:white;
 padding:4px 12px;border-radius:6px;
 font-weight:bold;font-size:16px;
}

/* Smooth visuals */
body{
 background:linear-gradient(to bottom,#eaf6ff,#eaffe8);
}
</style>
</head>

<body>

<div class="strip"></div>

<header class="gov-header">
 <div style="display:flex;align-items:center;gap:10px;">
    <img class="ashoka" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/500px-Emblem_of_India.svg.png" alt="" width="45">
    <div><b>Vote Rakshak</b><br><small>Live Election Results</small></div>
 </div>

 <nav class="top-links">
    <a href="/">Home</a>
    <a href="/voter">Vote</a>
    <a href="/candidate">Candidates</a>
 </nav>
</header>

<div class="container">

<div id="winnerBox">Loading results...</div>

<div class="results-container">

 <div class="chart-card">
    <p class="chart-title">Vote Share - Pie Chart</p>
    <canvas id="pieChart" width="380" height="380"></canvas>
 </div>

 <div class="chart-card">
    <p class="chart-title">Votes Comparison - Bar Graph</p>
    <canvas id="barChart" width="380" height="380"></canvas>
 </div>

</div>

<!-- Candidate Vote Table -->
<div class="candidateBox">
 <h3>üìã Candidate Vote Count</h3>
 <div id="voteList"></div>
</div>

</div>

<script>
let pieChart, barChart;

async function loadResults(){
 const res = await fetch("/candidates");
 const data = await res.json();

 const names = data.map(c=>c.name);
 const votes = data.map(c=>c.votes);

 // Winner
 let winner = data.reduce((a,b)=> a.votes>b.votes?a:b );
 document.getElementById("winnerBox").innerHTML =
 `üèÜ Winner: <b>${winner.name}</b> (${winner.votes} votes)`;

 // Update Vote List Table
 const box=document.getElementById("voteList");
 box.innerHTML="";
 data.forEach(c=>{
   box.innerHTML+=`
   <div class="candidateRow">
      <b>${c.name}</b>
      <span class="voteBadge">${c.votes}</span>
   </div>`;
 });

 /* Pie Chart */
 if(pieChart) pieChart.destroy();
 pieChart = new Chart(document.getElementById("pieChart"),{
  type:"pie",
  data:{labels:names,datasets:[{data:votes,
     backgroundColor:["#ff6384","#36a2eb","#ffce56",
                      "#4bc0c0","#9966ff","#ff9f40"]}]}
 });

 /* Bar Chart */
 if(barChart) barChart.destroy();
 barChart = new Chart(document.getElementById("barChart"),{
  type:"bar",
  data:{labels:names,datasets:[{label:"Votes",
      data:votes,backgroundColor:"#36a2eb"}]},
  options:{responsive:true,scales:{y:{beginAtZero:true}}}
 });
}

loadResults();
setInterval(loadResults,4000);
</script>

</body>
</html>
